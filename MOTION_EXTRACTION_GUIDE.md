# Motion Extraction and Clustering System π¬π¤–

μμ–΄ μμƒμ—μ„ MediaPipe ν‚¤ν¬μΈνΈλ¥Ό μ¶”μ¶ν•κ³  λ™μ‘ μ μ‚¬μ„±μ— λ”°λΌ ν΄λ¬μ¤ν„°λ§ν•λ” μ™„μ „ν• μ‹μ¤ν…

## π“‹ μ‹μ¤ν… κ°μ”

μ΄ μ‹μ¤ν…μ€ λ‹¤μ 4κ°€μ§€ ν•µμ‹¬ κΈ°λ¥μ„ μν–‰ν•©λ‹λ‹¤:

1. **λΌλ²¨ μ¶”μ¶**: `labels.csv`μ—μ„ μ λ‹ν¬ν• λΌλ²¨κ³Ό μ²« λ²μ§Έ νμΌλ… μ μ¶”μ¶
2. **ν‚¤ν¬μΈνΈ μ¶”μ¶**: MediaPipeλ¥Ό μ‚¬μ©ν•μ—¬ μμƒμ—μ„ ν¬μ¦, μ†, μ–Όκµ΄ ν‚¤ν¬μΈνΈ μ‹ν€Έμ¤ μ¶”μ¶
3. **λ°μ΄ν„° μ €μ¥**: μ¶”μ¶λ μ‹ν€Έμ¤λ¥Ό `extracted-src/` λ””λ ‰ν† λ¦¬μ— μ €μ¥ν•κ³  `extracted_labels.csv` μƒμ„±
4. **λ™μ‘ ν΄λ¬μ¤ν„°λ§**: λ™μ  νΉμ„±μ„ λ¶„μ„ν•μ—¬ μ μ‚¬ν• λ™μ‘λΌλ¦¬ ν΄λ¬μ¤ν„°λ§

## π—οΈ μ‹μ¤ν… κµ¬μ΅°

### ν•µμ‹¬ ν΄λμ¤λ“¤

- **`MotionExtractor`**: MediaPipe ν‚¤ν¬μΈνΈ μ¶”μ¶ λ° μ €μ¥
- **`MotionEmbedder`**: λ™μ  νΉμ„± μ¶”μ¶μ„ μ„ν• κ³ κΈ‰ μ„λ² λ”© μ‹μ¤ν…
- **`MotionClusterer`**: λ™μ‘ ν΄λ¬μ¤ν„°λ§ λ° λ¶„μ„

### νμΌ κµ¬μ΅°
```
π“ SaturdayDinner/
β”β”€β”€ π“„ extractor.py          # λ©”μΈ μ‹μ¤ν…
β”β”€β”€ π“„ test_extractor.py     # ν…μ¤νΈ μ¤ν¬λ¦½νΈ  
β”β”€β”€ π“„ video_path_utils.py   # λΉ„λ””μ¤ κ²½λ΅ μ ν‹Έλ¦¬ν‹°
β”β”€β”€ π“„ labels.csv            # μ›λ³Έ λΌλ²¨ λ°μ΄ν„° (43,889κ° νμΌ, 657κ° μ λ‹ν¬ λΌλ²¨)
β”β”€β”€ π“ extracted-src/        # μ¶”μ¶λ ν‚¤ν¬μΈνΈ μ‹ν€Έμ¤ μ €μ¥μ†
β””β”€β”€ π“„ extracted_labels.csv  # μ¶”μ¶λ μ‹ν€Έμ¤μ™€ λΌλ²¨ λ§¤ν•‘
```

## π”§ μ‚¬μ© λ°©λ²•

### 1. ν…μ¤νΈ μ‹¤ν–‰ (κ¶μ¥)
```bash
python test_extractor.py
```
μ†μμ μμƒμΌλ΅ μ‹μ¤ν…μ΄ μ •μƒ μ‘λ™ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

### 2. μ „μ²΄ μ‹μ¤ν… μ‹¤ν–‰
```bash
python extractor.py
```
λ¨λ“  μ λ‹ν¬ν• λΌλ²¨μ μμƒμ„ μ²λ¦¬ν•©λ‹λ‹¤ (657κ° μμƒ).

### 3. κ°λ³„ μ»΄ν¬λ„νΈ μ‚¬μ©
```python
from extractor import MotionExtractor, MotionEmbedder, MotionClusterer

# 1. ν‚¤ν¬μΈνΈ μ¶”μ¶
extractor = MotionExtractor()
labels_dict = extractor.extract_unique_labels_with_first_files("labels.csv")
sequences = extractor.extract_all_sequences(labels_dict)

# 2. λ™μ‘ ν΄λ¬μ¤ν„°λ§
embedder = MotionEmbedder()
clusterer = MotionClusterer(embedder)
results = clusterer.cluster_motions(sequences)
```

## π― κ³ κΈ‰ λ™μ  μ„λ² λ”© νΉμ„±

μ‹μ¤ν…μ€ λ™μ‘μ λ™μ  νΉμ„±μ„ ν¬μ°©ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ κ³ κΈ‰ νΉμ„±λ“¤μ„ μ¶”μ¶ν•©λ‹λ‹¤:

### 1. μ΄λ™ν•™μ  νΉμ„±
- **μ†λ„ (Velocity)**: ν”„λ μ„ κ°„ ν‚¤ν¬μΈνΈ μ΄λ™ μ†λ„
- **κ°€μ†λ„ (Acceleration)**: μ†λ„ λ³€ν™”μ¨
- **κ°μ†λ„ (Angular Velocity)**: κ΄€μ  κ°λ„ λ³€ν™”μ¨

### 2. κ¶¤μ  νΉμ„±
- **ν†µκ³„μ  νΉμ„±**: ν‰κ· , ν‘μ¤€νΈμ°¨, μµλ€/μµμ†κ°’, λ³€λ™ λ²”μ„
- **μ›€μ§μ„ ν¨ν„΄**: κ° λλ“λ§ν¬μ μ΄λ™ κ¶¤μ  λ¶„μ„

### 3. μ£Όνμ λ„λ©”μΈ νΉμ„±
- **FFT κΈ°λ° λ¶„μ„**: λ™μ‘μ μ£Όνμ μ„±λ¶„ λ¶„μ„
- **λ¦¬λ“¬/ν…ν¬ νΉμ„±**: λ™μ‘μ μ£ΌκΈ°μ„± λ° λ¦¬λ“¬ ν¨ν„΄

### 4. μ‹ μ²΄ λ¶€μ„λ³„ μƒλ€μ  μ›€μ§μ„
- **μ†-λΈν†µ λΉ„μ¨**: μ† μ›€μ§μ„ λ€λΉ„ λΈν†µ μ›€μ§μ„
- **μ–Όκµ΄-ν¬μ¦ κ΄€κ³„**: μ–Όκµ΄ ν‘μ •κ³Ό μ „μ²΄ ν¬μ¦μ μƒλ€μ  μ›€μ§μ„
- **μΆμ° κ· ν•**: μ–‘μ†μ μ›€μ§μ„ λΉ„κµ

## π“ μ¶λ ¥ λ°μ΄ν„°

### 1. extracted_labels.csv
```csv
sequence_path,label
extracted-src/KETI_SL_0000000419_MOV_ν™”μ¬.pkl,ν™”μ¬
extracted-src/KETI_SL_0000000415_MOV_ν™”μƒ.pkl,ν™”μƒ
...
```

### 2. ν‚¤ν¬μΈνΈ μ‹ν€Έμ¤ νμΌ (.pkl)
κ° νμΌμ—λ” `KeypointSequence` κ°μ²΄κ°€ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤:
- `pose_landmarks`: ν¬μ¦ ν‚¤ν¬μΈνΈ (33κ° μ )
- `left_hand_landmarks`: μ™Όμ† ν‚¤ν¬μΈνΈ (21κ° μ )  
- `right_hand_landmarks`: μ¤λ¥Έμ† ν‚¤ν¬μΈνΈ (21κ° μ )
- `face_landmarks`: μ–Όκµ΄ ν‚¤ν¬μΈνΈ (468κ° μ )
- `sequence`: μ „μ²΄ κ²°ν•©λ μ‹ν€Έμ¤
- `frame_count`, `fps`: λ©”νƒ€λ°μ΄ν„°

### 3. ν΄λ¬μ¤ν„°λ§ κ²°κ³Ό
```python
clustering_results = {
    'cluster_labels': [...],      # κ° λ™μ‘μ ν΄λ¬μ¤ν„° λΌλ²¨
    'motion_labels': [...],       # μ›λ³Έ ν•κµ­μ–΄ λΌλ²¨  
    'features': [...],            # PCA ν›„ νΉμ„± λ²΅ν„°
    'n_clusters': 15,             # μλ™ μ„ νƒλ ν΄λ¬μ¤ν„° μ
    'sequences': [...]            # μ›λ³Έ μ‹ν€Έμ¤ κ°μ²΄λ“¤
}
```

## π― ν΄λ¬μ¤ν„°λ§ μλ™ μµμ ν™”

μ‹μ¤ν…μ€ λ‹¤μ λ°©λ²•μΌλ΅ μµμ μ ν΄λ¬μ¤ν„° μλ¥Ό μλ™ μ„ νƒν•©λ‹λ‹¤:

1. **μ‹¤λ£¨μ—£ μ¤μ½”μ–΄**: ν΄λ¬μ¤ν„° λ‚΄ μ‘μ§‘λ„μ™€ ν΄λ¬μ¤ν„° κ°„ λ¶„λ¦¬λ„ ν‰κ°€
2. **PCA μ°¨μ› μ¶•μ†**: 95% λ¶„μ‚°μ„ μ μ§€ν•λ©΄μ„ μ°¨μ› μ¶•μ†
3. **ν‘μ¤€ν™”**: λ¨λ“  νΉμ„±μ„ λ™μΌν• μ¤μΌ€μΌλ΅ μ •κ·ν™”

## π” νΉμ„± μ¶”μ¶ μ„Έλ¶€μ‚¬ν•­

### MediaPipe ν‚¤ν¬μΈνΈ
- **ν¬μ¦**: 33κ° λλ“λ§ν¬ (μ–΄κΉ¨, ν”κΏμΉ, μ†λ©, μ—‰λ©μ΄, λ¬΄λ¦, λ°λ© λ“±)
- **μ†**: κ° μ†λ‹Ή 21κ° λλ“λ§ν¬ (μ†κ°€λ½ κ΄€μ λ“¤)
- **μ–Όκµ΄**: 468κ° λλ“λ§ν¬ (λ, μ½”, μ…, μ–Όκµ΄ μ¤κ³½)

### λ™μ  νΉμ„± λ²΅ν„°
```python
features = [
    velocity_features,      # μ†λ„ κ΄€λ ¨ νΉμ„±
    acceleration_features,  # κ°€μ†λ„ νΉμ„±  
    angular_features,       # κ°μ†λ„ νΉμ„±
    trajectory_features,    # κ¶¤μ  ν†µκ³„ νΉμ„±
    frequency_features,     # μ£Όνμ λ„λ©”μΈ νΉμ„±
    relative_motion         # μƒλ€μ  μ›€μ§μ„ νΉμ„±
]
```

## π€ μ„±λ¥ λ° ν™•μ¥μ„±

- **λ³‘λ ¬ μ²λ¦¬**: κ°€λ¥ν• λ¶€λ¶„μ—μ„ λ³‘λ ¬ μ²λ¦¬ μ§€μ›
- **λ©”λ¨λ¦¬ ν¨μ¨μ„±**: λ€μ©λ‰ λΉ„λ””μ¤ μ²λ¦¬λ¥Ό μ„ν• μ¤νΈλ¦¬λ° λ°©μ‹
- **μ¤λ¥ λ³µκµ¬**: κ°λ³„ νμΌ μ²λ¦¬ μ‹¤ν¨κ°€ μ „μ²΄ μ‹μ¤ν…μ— μν–¥μ„ μ£Όμ§€ μ•μ
- **μ§„ν–‰λ¥  ν‘μ‹**: tqdmμ„ ν†µν• μƒμ„Έν• μ§„ν–‰λ¥  ν‘μ‹

## π“ μμƒ κ²°κ³Ό

657κ°μ μ λ‹ν¬ν• λΌλ²¨λ΅λ¶€ν„°:
- λΉ„μ·ν• μλ―Έμ λ™μ‘λ“¤μ΄ κ°™μ€ ν΄λ¬μ¤ν„°λ΅ κ·Έλ£Ήν™”
- λ™μ  νΉμ„±μ΄ μ μ‚¬ν• λ™μ‘λ“¤μ μλ™ λ°κ²¬
- μμ–΄ λ™μ‘μ μ„Έλ°€ν• μ°¨μ΄μ κ³Ό κ³µν†µμ  λ¶„μ„

## π› οΈ μ”κµ¬μ‚¬ν•­

μ‹μ¤ν…μ€ `requirements_improved.txt`μ ν¨ν‚¤μ§€λ“¤μ„ μ‚¬μ©ν•©λ‹λ‹¤:
- `mediapipe>=0.10.0`: ν‚¤ν¬μΈνΈ μ¶”μ¶
- `opencv-python>=4.8.0`: λΉ„λ””μ¤ μ²λ¦¬
- `scikit-learn>=1.3.0`: ν΄λ¬μ¤ν„°λ§
- `numpy>=1.24.0`, `pandas>=2.0.0`: λ°μ΄ν„° μ²λ¦¬
- `tqdm>=4.65.0`: μ§„ν–‰λ¥  ν‘μ‹

## π‰ κ²°λ΅ 

μ΄ μ‹μ¤ν…μ€ μμ–΄ λ™μ‘μ λ³µμ΅ν• λ™μ  νΉμ„±μ„ ν¬μ°©ν•κ³  λ¶„μ„ν•  μ μλ” μ™„μ „ν• μ†”λ£¨μ…μ„ μ κ³µν•©λ‹λ‹¤. MediaPipeμ μ •ν™•ν• ν‚¤ν¬μΈνΈ μ¶”μ¶κ³Ό κ³ κΈ‰ λ™μ  μ„λ² λ”© κΈ°λ²•μ„ κ²°ν•©ν•μ—¬ μμ–΄ λ™μ‘μ λ―Έλ¬ν• μ°¨μ΄κΉμ§€ λ¶„μ„ν•  μ μμµλ‹λ‹¤. 